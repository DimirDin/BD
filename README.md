Домашнее задание «Базы данных, их типы»

Фамилия Имя: Гридин Владимир

Задание 1. СУБД

1.1. Бюджетирование, финансовая аналитика, оценка рисков

Решение:
Реляционная (SQL) СУБД — PostgreSQL или Oracle.
Причины:
жёсткая схема данных гарантирует целостность;
поддержка ACID-транзакций важна для денежных расчётов;
мощные средства аналитики (оконные функции, CUBE, ROLLUP);
встроенные типы денежных данных (money, numeric).

1.1.* Хеширование стало занимать много времени
Можно использовать API-ускорители хеширования:
Intel IPP (ippcpGetCpuFeatures + ippsHashMessage_rmf)
OpenSSL EVP с аппаратным AES-NI/SHA-NI
GPU-библиотеки (CUDA cuBLAS, hashcat как пример)
или построить кэш-хешей на Redis (ключ = исходные данные, значение = хеш).

1.2. Лендинги + CRM

Решение:
Для лендингов — key-value или документная СУБД: Redis, MongoDB.
Быстрый сброс лида без схемы, горизонтальное масштабирование.
Для CRM — та же MongoDB или PostgreSQL.
CRM нужны гибкие доп. поля к лидам → документная модель удобнее.

1.2.* Можно ли обойтись одной СУБД?
Да, MongoDB:
лендинги пишут «сырые» лиды в одну коллекцию;
CRM читает/обогащает те же документы;
используем Change Streams для реального времени;
шардирование по _id или projectId даёт горизонтальное масштабирование.

1.3. База знаний (нормы, обучение)

Решение:
Лёгкая реляционная СУБД — PostgreSQL или SQLite (если малая нагрузка).
Таблицы:
departments, documents, tags, attachments.
Простая внешняя структура, поиск по FULL-TEXT, удобные права.

1.3.* Использовать уже существующую?
Да, ту же PostgreSQL из п.1.1.
Создаём отдельную БД knowledge в том же кластере → экономия лицензий и админ-ресурсов.

1.4. Логистика (маршруты, курьеры)

Решение:
Графовая СУБД — Neo4j или PostgreSQL + расширение pgRouting.
Быстрый поиск кратчайших путей, алгоритм Дейкстры/A*.
Данные: (:Object)-[:DELIVERED_BY]->(:Courier).

1.4.* Подключать закупки?
Лучше оставить в той же графовой БД:
(:Supplier)-[:SUPPLIES]->(:Material)->[:DELIVERED_TO]->(:Object).
Если объём закупок огромен — вынести в отдельную БД (supply) и синхронизировать materialId через ETL.
1.5.* Одна СУБД на всё?

Возможно, но с оговорками:
PostgreSQL (multi-workload):
финансы — строгие таблицы;
документы — JSONB;
граф — age или pgRouting;
кэш — Redis-расширение pgmemcache + UNLOGGED-таблицы.
Риск: «загнать» кластер под разные SLА.
Вывод: для MVP — PostgreSQL подходит; при росте нагрузки дробить по типу данных.

Задание 2. Транзакции

2.1. Пополнение баланса телефона (6 шагов)

Пользователь вводит сумму.
Система авторизует внешний платёж (банк).
Старт транзакции в БД оператора.
UPDATE accounts SET balance = balance + X WHERE phone = N;
Запись в payment_history(id, phone, amount, status='SUCCESS').
COMMIT → ответ пользователю, SMS-уведомление.

2.1.* Автоплатёж
Дополнительные действия:
0. Проверка автоплатёжного соглашения (auto_pay = true).
1a. Планировщик (cron) запускает процедуру.
2a. Проверка лимита остатка на карте через банк-API.
3a. Если лимит OK → шаги 3-6 выше; иначе ROLLBACK и письмо «недостаточно средств».
Задание 3. SQL vs NoSQL

3.1. Преимущества SQL-систем

Гарантия ACID без дополнительного кода.
Жёсткая схема = защита от «грязных» данных на уровне БД.
Мощный стандартизированный язык запросов (SQL-92/2011).
Возможности сложных аналитических запросов (JOIN, CTE, окна).
Зрелые механизмы безопасности: роли, GRANT, Row-Level Security.

3.1.* Преимущества NewSQL

Сочетание ACID и горизонтального масштабирования (CockroachDB, Google Spanner).
Распределённые транзакции без единой «точки записи».
Синхронная репликация с Paxos/Raft → RPO ≈ 0.
Совместимость с ANSI-SQL, не нужно переписывать BI-запросы.
Эластичность облака: добавил ноду — получил +TPS без шардирования вручную.

Задание 4. Кластеры (1000 машин, огромные вычисления)

Критерий выбора СУБД:
Массовая распределённая обработка (high-throughput, not low-latency).
Линейное горизонтальное масштабирование.
Отказоустойчивость без единого координатора.
Лучшая модель:
MapReduce / SPARK + денормализованное хранилище (HDFS, Cassandra, ClickHouse).
Почему:
Данные уже разбиты на блоки ≈128 МБ и реплицированы ×3.
Каждая из 1000 машин обрабатывает локальный кусок («перемещай код, а не данные»).
Нет узкого места (master-node) при использовании YARN/Kubernetes.
Для промежуточных результатов можно поднять временные таблицы на той же ноде.
Альтернатива:
MPP-СУБД (Greenplum, Vertica) — если нужен SQL-интерфейс и сложные JOIN, но требуется дорогой инфинибэнд и одинаковое «железо».
